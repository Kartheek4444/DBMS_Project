<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments :: head('Edit Profile - VijayRentals')"></head>
<body class="font-poppins bg-gray-50">
<nav th:replace="fragments :: navbar"></nav>

<main class="min-h-screen py-12">
    <div class="container mx-auto px-4 max-w-4xl">
        <div class="flex items-center mb-8">
            <a th:href="@{/profile}" class="text-primary hover:text-secondary mr-4">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <h1 class="text-3xl font-bold text-gray-900">Edit Profile</h1>
        </div>

        <form th:action="@{/profile/edit}" th:object="${customer}" method="post" enctype="multipart/form-data" class="bg-white rounded-2xl shadow-lg p-8">
            <!-- Avatar Upload -->
            <div class="mb-8 text-center">
                <div class="inline-block relative">
                    <img id="avatarPreview"
                         th:src="${customer.avatarUrl != null ? customer.avatarUrl : '/uploads/avatars/default_avatar.png'}"
                         alt="Profile Picture"
                         class="w-32 h-32 rounded-full border-4 border-primary shadow-lg object-cover">
                    <label for="avatarFile" class="absolute bottom-0 right-0 bg-primary text-white p-2 rounded-full cursor-pointer hover:bg-secondary transition">
                        <i class="fas fa-camera"></i>
                    </label>
                    <input type="file" id="avatarFile" name="avatarFile" accept="image/*" class="hidden" onchange="previewAvatar(event)">
                </div>
                <p class="text-sm text-gray-500 mt-2">Click the camera icon to upload a new avatar</p>
            </div>

            <!-- Personal Information -->
            <h3 class="text-xl font-bold text-gray-900 mb-4">Personal Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">First Name*</label>
                    <input th:field="*{firstName}" type="text" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Last Name*</label>
                    <input th:field="*{lastName}" type="text" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div class="col-span-2">
                    <label class="block text-gray-700 font-medium mb-2">Middle Name(s)</label>
                    <div id="middleNamesContainer">
                        <div th:each="middleName, iterStat : ${customer.middleNames}" class="flex gap-2 mb-2">
                            <input th:field="*{middleNames[__${iterStat.index}__]}"
                                   type="text"
                                   placeholder="Middle Name"
                                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            <button type="button"
                                    onclick="removeMiddleName(this)"
                                    class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div th:if="${customer.middleNames == null or customer.middleNames.isEmpty()}" class="flex gap-2 mb-2">
                            <input th:field="*{middleNames[0]}"
                                   type="text"
                                   placeholder="Middle Name"
                                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            <button type="button"
                                    onclick="removeMiddleName(this)"
                                    class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button"
                            onclick="addMiddleName()"
                            class="mt-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition text-sm">
                        <i class="fas fa-plus mr-2"></i>Add Another Middle Name
                    </button>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Date of Birth</label>
                    <input th:field="*{dateOfBirth}"
                           type="date"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Phone Number*</label>
                    <input th:field="*{phoneNumber}" type="tel" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
            </div>



            <!-- License Information -->
            <h3 class="text-xl font-bold text-gray-900 mb-4">License Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">License Number</label>
                    <input th:field="*{licenseNo}" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Expiry Date</label>
                    <input th:field="*{expiryDate}"
                           type="date"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
            </div>

            <!-- Address Information -->
            <h3 class="text-xl font-bold text-gray-900 mb-4">Address</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Door/Building No</label>
                    <input th:field="*{dno}" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Street</label>
                    <input th:field="*{street}" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">City</label>
                    <input th:field="*{city}" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">State</label>
                    <input th:field="*{state}" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">PIN Code</label>
                    <input th:field="*{pinCode}" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex justify-end space-x-4">
                <a th:href="@{/profile}" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                    Cancel
                </a>
                <button type="submit" class="bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-secondary transition">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
            </div>
        </form>
    </div>
</main>

<footer th:replace="fragments :: footer"></footer>

<script>
    function previewAvatar(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatarPreview').src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    }
</script>
<script>
    function previewAvatar(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatarPreview').src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    }

    let middleNameIndex = document.querySelectorAll('#middleNamesContainer > div').length;

    function addMiddleName() {
        const container = document.getElementById('middleNamesContainer');
        const newDiv = document.createElement('div');
        newDiv.className = 'flex gap-2 mb-2';
        newDiv.innerHTML = `
            <input name="middleNames[${middleNameIndex}]"
                   type="text"
                   placeholder="Middle Name"
                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
            <button type="button"
                    onclick="removeMiddleName(this)"
                    class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                <i class="fas fa-times"></i>
            </button>
        `;
        container.appendChild(newDiv);
        middleNameIndex++;
    }

    function removeMiddleName(button) {
        const container = document.getElementById('middleNamesContainer');
        if (container.children.length > 1) {
            button.parentElement.remove();
        } else {
            const input = button.parentElement.querySelector('input');
            input.value = '';
        }
    }
</script>
</body>
</html>
